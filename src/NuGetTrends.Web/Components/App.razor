<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <title>NuGet Trends</title>
    <meta name="description" content="Check out NuGet packages adoption and what's trending on NuGet." />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="NuGet Trends" />
    <meta property="og:title" content="NuGet Trends" />
    <meta property="og:description" content="Check out NuGet packages adoption and what's trending on NuGet." />
    <meta property="og:url" content="https://nugettrends.com" />
    <meta property="og:image" content="https://nugettrends.com/images/banner_social.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:creator" content="@@AsProgrammerr" />
    <meta name="twitter:title" content="NuGet Trends" />
    <meta name="twitter:site" content="@@AsProgrammerr" />
    <meta name="twitter:description" content="Check out NuGet packages adoption and what's trending on NuGet." />
    <meta name="twitter:image" content="https://nugettrends.com/images/banner_social.png" />
    <meta name="twitter:image:width" content="1200" />
    <meta name="twitter:image:height" content="630" />

    <!-- Canonical & image -->
    <link rel="canonical" href="https://nugettrends.com" />
    <link rel="image_src" href="https://nugettrends.com/images/banner_social.png" />

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="@Assets["lib/bulma@0.9.4/bulma.min.css"]" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="@Assets["lib/font-awesome@4.7.0/css/font-awesome.min.css"]" />
    <!-- App styles -->
    <link rel="stylesheet" href="@Assets["css/app.css"]" />
    <!-- Blazor CSS isolation -->
    <link rel="stylesheet" href="@Assets["NuGetTrends.Web.styles.css"]" />
    <!-- Blazored Toast -->
    <link href="@Assets["_content/Blazored.Toast/Blazored.Toast.bundle.scp.css"]" rel="stylesheet" />
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="@Assets["favicon.ico"]" />

    <HeadOutlet @rendermode="InteractiveWebAssembly" />
</head>

<body class="site">
    <!-- Apply theme before first paint to prevent flash -->
    <script>
        (function() {
            var pref = localStorage.getItem('nuget-trends-theme');
            var dark = pref === 'dark' || (pref !== 'light' && window.matchMedia('(prefers-color-scheme: dark)').matches);
            document.body.classList.add(dark ? 'dark-theme' : 'light-theme');
        })();
    </script>
    <Routes @rendermode="new InteractiveWebAssemblyRenderMode(prerender: true)" />

    <!-- WASM loading progress bar — removed once Blazor boots -->
    <div id="wasm-loading-bar"></div>
    <style>
        #wasm-loading-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            height: 3px;
            background: var(--primary-color, #055499);
            z-index: 99999;
            animation: wasm-progress 8s ease-out forwards;
        }
        @@keyframes wasm-progress {
            0%   { width: 0; }
            30%  { width: 50%; }
            60%  { width: 75%; }
            100% { width: 95%; }
        }
    </style>

    <!-- Sentry Browser SDK (spa project) — catches JS errors even if WASM fails to boot -->
    <script
      src="https://js.sentry-cdn.com/85a592e835c64ca3a97d93776c12e947.min.js"
      crossorigin="anonymous"
    ></script>
    <script>
        Sentry.onLoad(function() {
            Sentry.init({
                tunnel: "/t",
                integrations: [Sentry.replayIntegration()],
                replaysSessionSampleRate: 0,
                replaysOnErrorSampleRate: 1.0,
            });
        });
    </script>

    <!-- Custom JS -->
    <script src="@Assets["js/themeInterop.js"]"></script>
    <script src="@Assets["js/uiInterop.js"]"></script>
    <!-- App version (server-rendered, read by Footer via JS interop) -->
    <script>window.__appVersion = "@_appVersion";</script>
    <!-- Blazor WebAssembly -->
    <script src="_framework/blazor.web.js" autostart="false"></script>
    <script>
        Blazor.start().then(function() {
            var bar = document.getElementById('wasm-loading-bar');
            if (bar) {
                bar.style.width = '100%';
                bar.style.transition = 'width 0.2s ease, opacity 0.3s ease 0.2s';
                bar.style.opacity = '0';
                setTimeout(function() { bar.remove(); }, 500);
            }
        }).catch(function(err) {
            console.error('Blazor WASM failed to start:', err);
            Sentry.captureException(err);
        });
    </script>
</body>

</html>

@code {
    private string _appVersion = "unknown";

    protected override void OnInitialized()
    {
        var assembly = System.Reflection.Assembly.GetExecutingAssembly();
        var informationalVersion = assembly
            .GetCustomAttributes<System.Reflection.AssemblyInformationalVersionAttribute>()
            .FirstOrDefault()?
            .InformationalVersion;

        if (!string.IsNullOrEmpty(informationalVersion))
        {
            var parts = informationalVersion.Split('+');
            _appVersion = parts.Length > 1 ? parts[1] : informationalVersion;
        }
    }
}
